{% extends "bootstrap/base.html" %}

{% block title %}Flasky{% endblock %}
{% block navbar %}
<div class="navbar navbar-inverse" role="navigation">
<div class="container">
<div class="navbar-header">
<button type="button" class="navbar-toggle"
data-toggle="collapse" data-target=".navbar-collapse">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/">Flasky</a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li><a href="/">Home</a></li>
</ul>
</div>
</div>
</div>
{% endblock %}
{% block content %}
<div class="container">
<div class="page-header">
<h1>Hello, {{ name }}!</h1>
<form method="POST">
{{ form.hidden_tag() }}
{{ form.name.label }} {{ form.name(id='my-text-field') }}
{{ form.submit() }}
</form>
<div class="panel-body">
		<!--内容块开始-->
		<div>
			<textarea id="content" name="RawJson" class="json_input" rows="10" style="width: 100%;" spellcheck="false" placeholder="请在excel里复制下内容贴到上面一个文本框里"></textarea>
		</div>

		<div class="input-group" style="width:180px;float:left;margin-right:20px ;">
			<span class="input-group-addon" id="basic-addon1">分隔符</span>
			<input type="text" class="form-control" id="fgfstr" placeholder="默认是制表符" aria-describedby="basic-addon1">
		</div>
		<div class="btn-group" role="group" aria-label="..." style="float:left;margin-right:20px">
			 <button type="button" class="btn btn-primary" id="changebtn">转换</button>
			  <button type="button" class="btn btn-primary" id="testcase">来个demo</button>
			   <button type="button" class="btn btn-danger" onclick="$('textarea').val('')">清空</button>
		</div>

		<div class="btn-group" role="group" aria-label="..." style="float:left;margin-right:20px">
		 <button id="sels" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">按行转成对象</button>
		  <ul class="dropdown-menu">
		  	<li><a href="javascript:;" onclick="c(0,this)">按行转成对象</a></li>
		    <li><a href="javascript:;" onclick="c(1,this)">按行转成数组</a></li>
		  </ul>
		 </div>
		 <div style="clear: both;"></div>
		<div style="padding-top: 10px;">
			<textarea id="result" name="RawJson" class="json_input" rows="10" style="width: 100%;" spellcheck="false" placeholder="转换后的内容"></textarea>
		</div>
		<input type="hidden" id="ctype" value="0">
		<!--内容块结束-->
	</div>
</div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
   $("#testcase").click(function(){
		$("#content").val("name	payment	url	asdf\naaa中文测试	999	http://www.bejson.com	asdf\nbbb	888	http://www.bejson.com	asdf\nccc中文测试	777	http://www.bejson.com	asdf\nddd	666	http://www.bejson.com	asdf\neee中文测试	555	http://www.bejson.com	asdf\nfff	444	http://www.bejson.com	asdf");
	});
		function c(t,o){
			$("#ctype").val(t);
			$("#sels").text($(o).text());
		}
		var fgf = /\t/;
		function ctyperow(){
			fgf = $("#fgfstr").val()||fgf;
			var ctype = $("#ctype").val();
			var txt = $("#content").val() ;
			var datas = txt.split("\n");
			var html = "[\n";
			var keys = [];
			for(var i=0;i< datas.length;i++){
				var ds = datas[i].split(fgf);
				if(i==0){
					
					if(ctype=="0"){
						keys = ds;
					}else{
						html+="[";
						for(var j=0;j<ds.length;j++){
							html+= '"'+ds[j]+'"';
							if(j<ds.length-1){
								html+=","; 
							}
						}
						html+="],\n";
					}
				}else{
					if(ds.length==0)continue;
					if(ds.length==1){
						ds[0]=="";
						continue;
					}
					html+=ctype=="0"?"{":"[";
					for(var j=0;j<ds.length;j++){
						var d = ds[j];
						if(d=="")continue;
						if(ctype=="0"){
						html+='"'+keys[j]+'":"'+d+'"';
						}else{
							html+='"'+d+'"';
						}
						if(j<ds.length-1){
							html+=',';
						}
					}
					html+=ctype=="0"?"}":"]";
					if(i< datas.length-1)
					html+=",\n";
				}
				
				
			}
			 html += "\n]";
			$("#result").val(html);
		}
		$("#content").bind("change1",function(){
			var ctype = $("#ctype").val();
			var txt = "";
			if(ctype=="0"){
				txt = ctype0();
			}
		})
		$("#changebtn").click(function(){
			ctyperow(true);
		});
</script>
{% endblock %}
